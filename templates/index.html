<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>CaseBlitz</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-6">
  <header class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-purple-500">üéÅ CaseBlitz</h1>
    {% if user %}
    <div>
      <span>üë§ {{ user.username }}</span> | 
      <span>üí∞ –ë–∞–ª–∞–Ω—Å: {{ user.balance }}‚ÇΩ</span> | 
      <a href="{{ url_for('logout') }}" class="text-red-400 hover:underline">–í—ã–π—Ç–∏</a>
    </div>
    {% else %}
    <div>
      <a href="{{ url_for('login') }}" class="mr-4 text-green-400 hover:underline">–í–æ–π—Ç–∏</a>
      <a href="{{ url_for('register') }}" class="text-green-400 hover:underline">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
    </div>
    {% endif %}
  </header>

  {% if user %}
  <section>
    <h2 class="text-xl mb-4">–ö–µ–π—Å—ã</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <div class="bg-gray-800 p-4 rounded shadow hover:shadow-lg transition cursor-pointer" onclick="openCase('starter', 100)">
        <h3 class="font-semibold mb-2">üéí Starter Case</h3>
        <p>–¶–µ–Ω–∞: 100‚ÇΩ</p>
      </div>
      <div class="bg-gray-800 p-4 rounded shadow hover:shadow-lg transition cursor-pointer" onclick="openCase('epic', 300)">
        <h3 class="font-semibold mb-2">üß® Epic Case</h3>
        <p>–¶–µ–Ω–∞: 300‚ÇΩ</p>
      </div>
      <div class="bg-gray-800 p-4 rounded shadow hover:shadow-lg transition cursor-pointer" onclick="openCase('legendary', 600)">
        <h3 class="font-semibold mb-2">üî• Legendary Case</h3>
        <p>–¶–µ–Ω–∞: 600‚ÇΩ</p>
      </div>
      <div class="bg-gray-800 p-4 rounded shadow hover:shadow-lg transition cursor-pointer" onclick="openCase('ultra', 1000)">
        <h3 class="font-semibold mb-2">üëë Ultra Case</h3>
        <p>–¶–µ–Ω–∞: 1000‚ÇΩ</p>
      </div>
    </div>
  </section>

  <section class="mt-8">
    <h2 class="text-xl mb-4">–¢–≤–æ–π –¥—Ä–æ–ø</h2>
    <ul id="drops" class="space-y-2">
      {% for drop in user.drops %}
      <li class="bg-gray-700 p-3 rounded flex justify-between items-center">
        <span>{{ drop.item_name }} ({{ drop.price }}‚ÇΩ)</span>
        <button onclick="sellDrop({{ drop.id }})" class="bg-red-600 px-2 py-1 rounded hover:bg-red-700">–ü—Ä–æ–¥–∞—Ç—å</button>
      </li>
      {% else %}
      <li>–£ —Ç–µ–±—è –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤</li>
      {% endfor %}
    </ul>
  </section>

  <section class="mt-8">
    <h2 class="text-xl mb-4">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</h2>
    <input type="number" id="topupAmount" class="p-2 rounded text-black" min="10" value="100" />
    <button onclick="topUp()" class="bg-green-600 px-4 py-2 rounded hover:bg-green-700">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
  </section>
  {% else %}
  <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –∏–≥—Ä–∞—Ç—å.</p>
  {% endif %}

  <script>
    async function openCase(type, price) {
      const res = await fetch('/open_case', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({type, price})
      });
      const data = await res.json();
      if(data.error) return alert(data.error);
      alert(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í–∞–º –≤—ã–ø–∞–ª ${data.drop}`);
      location.reload();
    }
    async function sellDrop(drop_id) {
      const res = await fetch('/sell_drop', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({drop_id})
      });
      const data = await res.json();
      if(data.error) return alert(data.error);
      alert('–ü—Ä–µ–¥–º–µ—Ç –ø—Ä–æ–¥–∞–Ω!');
      location.reload();
    }
    async function topUp() {
      const amount = parseInt(document.getElementById('topupAmount').value);
      if(amount <= 0) return alert('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –±–æ–ª—å—à–µ 0');
      const res = await fetch('/topup', {
